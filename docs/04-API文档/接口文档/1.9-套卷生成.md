# 1.9 套卷生成 API

**Base Path**: `/api/v1/papers`

| 方法   | 路径        | 功能           | 说明                                     |
| ------ | ----------- | -------------- | ---------------------------------------- |
| POST   | `/generate` | 生成套卷 (SSE) | 核心功能，异步并发生成套卷，通过 SSE 推送进度 |
| GET    | `/history`  | 获取历史记录   | 获取当前用户的套卷生成历史列表           |
| GET    | `/{paperId}`| 获取套卷详情   | 查看某套试卷的完整内容（包含所有题型）   |
| DELETE | `/{paperId}`| 删除套卷       | 删除指定套卷记录                         |

### 1.9.1 生成套卷 (SSE)

- **接口地址**: `/api/v1/papers/generate`
- **请求方式**: `POST`
- **Content-Type**: `application/json`
- **响应类型**: `text/event-stream`
- **认证**: `Bearer Token`

#### 请求参数 (PaperGenerationRequest)

| 字段名 | 类型 | 必填 | 说明 | 示例 |
| :--- | :--- | :--- | :--- | :--- |
| subjectId | long | 是 | 科目ID | 1 |
| paperName | string | 是 | 套卷名称 | "2024英语模拟卷一" |
| **enableThinking** | **boolean** | **否** | **是否启用深度思考 (默认false)** | **true** |
| paperConfig | list | 否 | 自定义组卷配置，不传则使用默认模版 | See below |

**PaperConfigItem 结构**:
| 字段名 | 类型 | 说明 | 示例 |
| :--- | :--- | :--- | :--- |
| questionType | string | 题型编码 | "grammar_fill_blank" |
| quantity | int | 数量 | 5 |
| difficulty | string | 难度 | "medium" |
| theme | string | 主题 | "Technology" |

#### SSE 事件流

前端需监听以下事件：

1.  **`question`**: 单个题型生成完成
    ```json
    {
      "questionType": "grammar_fill_blank",
      "generatedQuestions": "JSON string",
      "currentProgress": 1,
      "totalTasks": 4
    }
    ```
2.  **`error`**: 某个题型生成失败
    ```json
    {
      "questionType": "reading_comprehension",
      "message": "AI service timeout"
    }
    ```
3.  **`complete`**: 所有任务完成
    ```json
    {
      "paperId": 1001,
      "status": "COMPLETED"
    }
    ```

### 1.9.2 获取历史记录

- **接口地址**: `/api/v1/papers/history`
- **请求方式**: `GET`
- **认证**: `Bearer Token`

#### 响应结果 (Result<List<PaperHistoryItem>>)

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1001,
      "paperName": "2024英语模拟卷一",
      "subjectName": "湖北专升本英语",
      "totalQuestions": 20,
      "enableThinking": true,
      "createdAt": "2025-12-05T14:30:00"
    }
  ]
}
```

### 1.9.3 获取套卷详情

- **接口地址**: `/api/v1/papers/{paperId}`
- **请求方式**: `GET`
- **认证**: `Bearer Token`

#### 路径参数

| 参数名 | 类型 | 说明 |
| :--- | :--- | :--- |
| paperId | long | 套卷 ID |

#### 响应结果 (Result<PaperDetailResponse>)

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1001,
    "paperName": "2024英语模拟卷一",
    "subjectName": "湖北专升本英语",
    "questionDetails": [
      {
        "questionType": "grammar_fill_blank",
        "questionTypeName": "语法填空",
        "generatedQuestions": "..."
      }
    ]
  }
}
```

### 1.9.4 删除套卷

- **接口地址**: `/api/v1/papers/{paperId}`
- **请求方式**: `DELETE`
- **认证**: `Bearer Token`

#### 响应结果 (Result<Void>)

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```
