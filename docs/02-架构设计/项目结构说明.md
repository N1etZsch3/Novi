# Novi é¡¹ç›®ç»“æ„è¯´æ˜æ–‡æ¡£

## ğŸ“‚ é¡¹ç›®æ ¹ç›®å½•ç»“æ„

```
Novi/
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ .git/                       # Gitç‰ˆæœ¬æ§åˆ¶
â”œâ”€â”€ .gitignore                  # Gitå¿½ç•¥è§„åˆ™
â”œâ”€â”€ .idea/                      # IntelliJ IDEAé…ç½®
â”œâ”€â”€ .mvn/                       # Maven Wrapperé…ç½®
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ æ¥å£æ–‡æ¡£/
â”‚   â”œâ”€â”€ è®¾è®¡æ€è·¯.md
â”‚   â””â”€â”€ é‡æ„æŠ¥å‘Š.md
â”œâ”€â”€ logs/                       # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ pom.xml                     # Mavené¡¹ç›®é…ç½®
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ novi-v4-demo.html          # å‰ç«¯æ¼”ç¤ºé¡µé¢
â”œâ”€â”€ src/                        # æºä»£ç ç›®å½•
â””â”€â”€ æ–°å¢éœ€æ±‚.md                 # éœ€æ±‚æ–‡æ¡£
```

## ğŸ—‚ï¸ æºä»£ç ç»“æ„ï¼ˆsrc/main/javaï¼‰

### å®Œæ•´ç›®å½•æ ‘

```
com.n1etzsch3.novi/
â”œâ”€â”€ NoviApplication.java        # Spring Boot ä¸»å¯åŠ¨ç±»
â”‚
â”œâ”€â”€ client/                     # å¤–éƒ¨APIå®¢æˆ·ç«¯å±‚
â”‚   â””â”€â”€ [å¤–éƒ¨æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯]
â”‚
â”œâ”€â”€ config/                     # é…ç½®å±‚
â”‚   â”œâ”€â”€ ChatConfig.java         # èŠå¤©ç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ DynamicChatModelFactory.java  # åŠ¨æ€æ¨¡å‹å·¥å‚
â”‚   â”œâ”€â”€ SecurityConfig.java     # å®‰å…¨é…ç½®ï¼ˆJWTç­‰ï¼‰
â”‚   â””â”€â”€ WebConfig.java          # Webé…ç½®ï¼ˆCORSç­‰ï¼‰
â”‚
â”œâ”€â”€ controller/                 # æ§åˆ¶å™¨å±‚ï¼ˆREST APIï¼‰
â”‚   â”œâ”€â”€ AiModelConfigController.java      # AIæ¨¡å‹é…ç½®API
â”‚   â”œâ”€â”€ AiPromptConfigController.java     # AIæç¤ºè¯é…ç½®API
â”‚   â”œâ”€â”€ ChatController.java               # èŠå¤©API
â”‚   â”œâ”€â”€ ChatSessionController.java        # ä¼šè¯ç®¡ç†API
â”‚   â”œâ”€â”€ UserAccountController.java        # ç”¨æˆ·è´¦å·API
â”‚   â””â”€â”€ UserPreferenceController.java     # ç”¨æˆ·åå¥½API
â”‚
â”œâ”€â”€ domain/                     # é¢†åŸŸæ¨¡å‹å±‚
â”‚   â”œâ”€â”€ dto/                    # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ ChatRequest.java
â”‚   â”‚   â”œâ”€â”€ ChatResponse.java
â”‚   â”‚   â”œâ”€â”€ LoginRequest.java
â”‚   â”‚   â”œâ”€â”€ RegisterRequest.java
â”‚   â”‚   â”œâ”€â”€ Result.java         # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ po/                     # æŒä¹…åŒ–å¯¹è±¡ï¼ˆå®ä½“ç±»ï¼‰
â”‚       â”œâ”€â”€ AiModelConfig.java
â”‚       â”œâ”€â”€ AiPromptConfig.java
â”‚       â”œâ”€â”€ ChatMessage.java
â”‚       â”œâ”€â”€ ChatSession.java
â”‚       â”œâ”€â”€ QuestionExample.java
â”‚       â”œâ”€â”€ QuestionGenerationRecord.java
â”‚       â”œâ”€â”€ UserAccount.java
â”‚       â””â”€â”€ UserMemory.java
â”‚
â”œâ”€â”€ enums/                      # æšä¸¾ç±»
â”‚   â””â”€â”€ [ä¸šåŠ¡æšä¸¾å®šä¹‰]
â”‚
â”œâ”€â”€ exception/                  # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ GlobalExceptionHandler.java  # å…¨å±€å¼‚å¸¸å¤„ç†å™¨
â”‚   â””â”€â”€ [è‡ªå®šä¹‰å¼‚å¸¸ç±»]
â”‚
â”œâ”€â”€ interceptor/                # æ‹¦æˆªå™¨
â”‚   â””â”€â”€ LoginInterceptor.java  # ç™»å½•éªŒè¯æ‹¦æˆªå™¨
â”‚
â”œâ”€â”€ mapper/                     # æ•°æ®è®¿é—®å±‚ï¼ˆMyBatisï¼‰
â”‚   â”œâ”€â”€ AiModelConfigMapper.java
â”‚   â”œâ”€â”€ AiPromptConfigMapper.java
â”‚   â”œâ”€â”€ ChatMemoryMapper.java
â”‚   â”œâ”€â”€ ChatSessionMapper.java
â”‚   â”œâ”€â”€ QuestionExampleMapper.java
â”‚   â”œâ”€â”€ QuestionGenerationRecordMapper.java
â”‚   â”œâ”€â”€ UserAccountMapper.java
â”‚   â””â”€â”€ UserMemoryMapper.java
â”‚
â”œâ”€â”€ repository/                 # Spring AI ä»“åº“å±‚
â”‚   â”œâ”€â”€ NoviDatabaseChatMemory.java  # è‡ªå®šä¹‰èŠå¤©è®°å¿†å®ç°
â”‚   â””â”€â”€ NoviMemoryRepository.java    # è®°å¿†å­˜å‚¨ä»“åº“
â”‚
â”œâ”€â”€ service/                    # æœåŠ¡æ¥å£å±‚
â”‚   â”œâ”€â”€ AiModelConfigService.java
â”‚   â”œâ”€â”€ AiPromptConfigService.java
â”‚   â”œâ”€â”€ ChatService.java
â”‚   â”œâ”€â”€ ChatSessionService.java
â”‚   â”œâ”€â”€ QuestionGenerationService.java
â”‚   â”œâ”€â”€ UserAccountService.java
â”‚   â”œâ”€â”€ UserPreferenceService.java
â”‚   â”‚
â”‚   â””â”€â”€ impl/                   # æœåŠ¡å®ç°å±‚
â”‚       â”œâ”€â”€ AiModelConfigServiceImpl.java
â”‚       â”œâ”€â”€ AiPromptConfigServiceImpl.java
â”‚       â”œâ”€â”€ ChatServiceImpl.java
â”‚       â”œâ”€â”€ ChatSessionServiceImpl.java
â”‚       â”œâ”€â”€ QuestionGenerationServiceImpl.java
â”‚       â”œâ”€â”€ UserAccountServiceImpl.java
â”‚       â””â”€â”€ UserPreferenceServiceImpl.java
â”‚
â””â”€â”€ utils/                      # å·¥å…·ç±»
    â”œâ”€â”€ JwtUtil.java            # JWTå·¥å…·
    â”œâ”€â”€ LoginUserContext.java  # ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆThreadLocalï¼‰
    â””â”€â”€ [å…¶ä»–å·¥å…·ç±»]
```

## ğŸ—‚ï¸ èµ„æºæ–‡ä»¶ç»“æ„ï¼ˆsrc/main/resourcesï¼‰

```
resources/
â”œâ”€â”€ application.properties      # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ application.yml            # YAMLé…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ static/                    # SQLåˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ ai_model_config.sql
â”‚   â”œâ”€â”€ ai_prompt_config.sql
â”‚   â”œâ”€â”€ ai_prompt_context_config.sql
â”‚   â”œâ”€â”€ chat_message.sql
â”‚   â”œâ”€â”€ chat_session.sql
â”‚   â”œâ”€â”€ question_example.sql
â”‚   â”œâ”€â”€ question_generation_record.sql
â”‚   â”œâ”€â”€ user_account.sql
â”‚   â””â”€â”€ user_memory.sql
â”‚
â””â”€â”€ mapper/                    # MyBatis XMLæ˜ å°„æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
    â””â”€â”€ [Mapper XMLæ–‡ä»¶]
```

## ğŸ§ª æµ‹è¯•ä»£ç ç»“æ„ï¼ˆsrc/test/javaï¼‰

```
com.n1etzsch3.novi/
â”œâ”€â”€ NoviApplicationTests.java   # ä¸»æµ‹è¯•ç±»
â”‚
â”œâ”€â”€ controller/                 # æ§åˆ¶å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ ChatControllerTest.java
â”‚   â”œâ”€â”€ ChatSessionControllerTest.java
â”‚   â””â”€â”€ [å…¶ä»–Controlleræµ‹è¯•]
â”‚
â”œâ”€â”€ service/                    # æœåŠ¡å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ ChatServiceTest.java
â”‚   â””â”€â”€ [å…¶ä»–Serviceæµ‹è¯•]
â”‚
â””â”€â”€ mapper/                     # Mapperæµ‹è¯•
    â””â”€â”€ [Mapperæµ‹è¯•ç±»]
```

## ğŸ“‹ å„å±‚èŒè´£è¯´æ˜

### 1. Controller å±‚
- **èŒè´£**ï¼šå¤„ç†HTTPè¯·æ±‚å’Œå“åº”
- **ç‰¹ç‚¹**ï¼š
  - åªåšå‚æ•°éªŒè¯å’Œè°ƒç”¨Service
  - ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
  - ç»Ÿä¸€ä½¿ç”¨ `Result` å°è£…å“åº”
  - ä½¿ç”¨ `@RestController` æ³¨è§£

### 2. Service å±‚
- **èŒè´£**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†
- **ç‰¹ç‚¹**ï¼š
  - äº‹åŠ¡ç®¡ç†
  - ä¸šåŠ¡è§„åˆ™å®ç°
  - è·¨å±‚åè°ƒï¼ˆè°ƒç”¨å¤šä¸ªMapperï¼‰
  - æ¥å£ä¸å®ç°åˆ†ç¦»

### 3. Mapper å±‚
- **èŒè´£**ï¼šæ•°æ®åº“è®¿é—®
- **ç‰¹ç‚¹**ï¼š
  - ä½¿ç”¨ MyBatis-Plus
  - ç»§æ‰¿ `BaseMapper<T>`
  - è‡ªå®šä¹‰SQLä½¿ç”¨æ³¨è§£æˆ–XML

### 4. Domain å±‚
- **PO (Persistent Object)**ï¼šå¯¹åº”æ•°æ®åº“è¡¨
- **DTO (Data Transfer Object)**ï¼šAPIä¼ è¾“å¯¹è±¡

### 5. Config å±‚
- **èŒè´£**ï¼šSpringé…ç½®ç±»
- **å†…å®¹**ï¼š
  - Beané…ç½®
  - æ‹¦æˆªå™¨æ³¨å†Œ
  - ç¬¬ä¸‰æ–¹ç»„ä»¶åˆå§‹åŒ–

## ğŸ”„ æ•°æ®æµå‘

```
è¯·æ±‚æµå‘ï¼š
Client â†’ Controller â†’ Service â†’ Mapper â†’ Database

å“åº”æµå‘ï¼š
Database â†’ Mapper â†’ Service â†’ Controller â†’ Client
```

## ğŸ“¦ ä¾èµ–ç®¡ç†ï¼ˆpom.xmlï¼‰

### æ ¸å¿ƒä¾èµ–

| ä¾èµ– | ç”¨é€” |
|------|------|
| spring-boot-starter-web | Webåº”ç”¨åŸºç¡€ |
| spring-ai-starter-model-openai | Spring AIé›†æˆ |
| mybatis-plus-boot-starter | MyBatis-Plus ORM |
| mysql-connector-j | MySQLé©±åŠ¨ |
| jjwt | JWTè®¤è¯ |
| spring-security-crypto | å¯†ç åŠ å¯† |
| lombok | ç®€åŒ–ä»£ç  |

## ğŸ¯ è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. å·¥å‚æ¨¡å¼
- `DynamicChatModelFactory`ï¼šåŠ¨æ€åˆ›å»ºChatClient

### 2. å•ä¾‹æ¨¡å¼
- Spring Beané»˜è®¤å•ä¾‹

### 3. æ¨¡æ¿æ–¹æ³•æ¨¡å¼
- MyBatis-Plusçš„BaseMapper

### 4. ç­–ç•¥æ¨¡å¼
- ä¸åŒAIæ¨¡å‹çš„åˆ‡æ¢

### 5. è§‚å¯Ÿè€…æ¨¡å¼
- Springäº‹ä»¶æœºåˆ¶

## ğŸ“ å‘½åè§„èŒƒ

### ç±»å‘½å
- Controller: `xxxController`
- Serviceæ¥å£: `xxxService`
- Serviceå®ç°: `xxxServiceImpl`
- Mapper: `xxxMapper`
- å®ä½“ç±»: å®ä½“åç§°ï¼ˆå¦‚ `UserAccount`ï¼‰
- DTO: `xxxRequest`/`xxxResponse`

### æ–¹æ³•å‘½å
- æŸ¥è¯¢: `get`/`find`/`list`
- æ–°å¢: `add`/`create`/`save`
- ä¿®æ”¹: `update`/`modify`
- åˆ é™¤: `delete`/`remove`

## ğŸ” å®‰å…¨æœºåˆ¶

### è®¤è¯æµç¨‹
1. ç”¨æˆ·ç™»å½• â†’ è¿”å›JWT Token
2. è¯·æ±‚æºå¸¦Token â†’ æ‹¦æˆªå™¨éªŒè¯
3. æå–ç”¨æˆ·ä¿¡æ¯ â†’ å­˜å…¥ThreadLocal
4. ä¸šåŠ¡å¤„ç† â†’ ä»ThreadLocalè·å–ç”¨æˆ·

### æƒé™æ§åˆ¶
- ä½¿ç”¨æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†
- éƒ¨åˆ†æ¥å£éœ€è¦ç™»å½•
- ç®¡ç†å‘˜æ¥å£å•ç‹¬éªŒè¯

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ¦‚è§ˆ](file:///C:/Users/35666/.gemini/antigravity/brain/774ebe23-99e1-46d9-a3e1-52263e77b58e/é¡¹ç›®æ¦‚è§ˆ.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](file:///C:/Users/35666/.gemini/antigravity/brain/774ebe23-99e1-46d9-a3e1-52263e77b58e/æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)
