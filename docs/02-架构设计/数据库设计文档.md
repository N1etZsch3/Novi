# Novi æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ•°æ®åº“æ¦‚è¿°

**æ•°æ®åº“åç§°**ï¼š`novi`  
**å­—ç¬¦é›†**ï¼š`utf8mb4`  
**æ’åºè§„åˆ™**ï¼š`utf8mb4_unicode_ci`  
**æ•°æ®åº“å¼•æ“**ï¼šInnoDB

## ğŸ“Š ER å…³ç³»å›¾

```mermaid
erDiagram
    user_account ||--o{ chat_session : "æ‹¥æœ‰"
    user_account ||--o{ chat_message : "å‘é€"
    user_account ||--o{ user_memory : "æ‹¥æœ‰"
    user_account ||--o{ question_generation_record : "åˆ›å»º"
    chat_session ||--o{ chat_message : "åŒ…å«"
    question_example }o--|| question_generation_record : "å‚è€ƒ"
    
    user_account {
        bigint id PK
        varchar username UK
        varchar hashed_password
        varchar email UK
        varchar nickname
        json preferences
        datetime created_at
        datetime updated_at
    }
    
    chat_session {
        varchar id PK
        bigint user_id FK
        varchar title
        datetime created_at
        datetime updated_at
        tinyint is_deleted
    }
    
    chat_message {
        bigint id PK
        varchar session_id FK
        bigint user_id FK
        varchar role
        text content
        datetime timestamp
    }
    
    user_memory {
        bigint id PK
        bigint user_id FK
        varchar fact_key
        text fact_value
        varchar fact_type
        bigint source_message_id FK
        datetime created_at
        datetime last_accessed_at
    }
    
    ai_model_config {
        bigint id PK
        varchar model_name UK
        varchar base_url
        varchar api_key
        varchar completions_path
        tinyint is_active
        varchar description
        datetime create_time
        datetime update_time
    }
    
    ai_prompt_config {
        bigint id PK
        varchar config_key UK
        text config_value
        varchar description
        int config_type
        datetime create_time
        datetime update_time
    }
    
    question_example {
        bigint id PK
        varchar subject
        varchar question_type
        varchar difficulty
        json content
        varchar description
        datetime created_at
        datetime updated_at
    }
    
    question_generation_record {
        bigint id PK
        bigint user_id FK
        varchar subject
        varchar question_type
        varchar theme
        varchar difficulty
        int quantity
        json generated_questions
        datetime created_at
        datetime updated_at
    }

    paper_generation_record {
        bigint id PK
        bigint user_id FK
        bigint subject_id FK
        varchar paper_name
        int total_questions
        tinyint enable_thinking
        datetime created_at
        datetime updated_at
    }

    paper_question_detail {
        bigint id PK
        bigint paper_id FK
        varchar question_type
        varchar question_type_name
        varchar difficulty
        int quantity
        varchar theme
        json generated_questions
        int display_order
        datetime created_at
    }

    user_account ||--o{ paper_generation_record : "ç”Ÿæˆ"
    paper_generation_record ||--o{ paper_question_detail : "åŒ…å«"
    question_category ||--o{ paper_generation_record : "å…³è”ç§‘ç›®"
```

## ğŸ—„ï¸ æ•°æ®è¡¨è¯¦ç»†è®¾è®¡

### 1. user_accountï¼ˆç”¨æˆ·è´¦å·è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯å’Œè®¤è¯å‡­æ®

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ç”¨æˆ·ID |
| username | VARCHAR(50) | UNIQUE, NOT NULL | ç”¨æˆ·å |
| hashed_password | VARCHAR(255) | NOT NULL | åŠ å¯†åçš„å¯†ç  |
| nickname | VARCHAR(50) | | æ˜µç§° |
| email | VARCHAR(100) | UNIQUE | é‚®ç®± |
| preferences | JSON | | ç”¨æˆ·åå¥½è®¾ç½® |
| created_at | TIMESTAMP | DEFAULT NOW() | æ³¨å†Œæ—¶é—´ |
| updated_at | TIMESTAMP | ON UPDATE NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- UNIQUE KEY (`username`)
- UNIQUE KEY (`email`)

**SQLè„šæœ¬**ï¼š`user_account.sql`

---

### 2. chat_sessionï¼ˆèŠå¤©ä¼šè¯è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨èŠå¤©ä¼šè¯å…ƒæ•°æ®

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | VARCHAR(100) | PK | ä¼šè¯ID (UUID) |
| user_id | BIGINT | NOT NULL, FK | ç”¨æˆ·ID |
| title | VARCHAR(255) | | ä¼šè¯æ ‡é¢˜ |
| created_at | TIMESTAMP | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | ON UPDATE NOW() | æœ€åæ´»è·ƒæ—¶é—´ |
| is_deleted | TINYINT(1) | DEFAULT 0 | æ˜¯å¦åˆ é™¤ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- KEY `idx_user_updated` (`user_id`, `updated_at`)

**SQLè„šæœ¬**ï¼š`chat_session.sql`

---

### 3. chat_messageï¼ˆèŠå¤©æ¶ˆæ¯è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨èŠå¤©æ¶ˆæ¯å†…å®¹ï¼ˆå®ç°ä¸Šä¸‹æ–‡è®°å¿†ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | æ¶ˆæ¯ID |
| user_id | BIGINT | NOT NULL, FK | ç”¨æˆ·ID |
| session_id | VARCHAR(100) | NOT NULL, FK | ä¼šè¯ID |
| role | VARCHAR(20) | NOT NULL | è§’è‰²ï¼šuser/assistant |
| content | TEXT | NOT NULL | æ¶ˆæ¯å†…å®¹ |
| timestamp | TIMESTAMP | DEFAULT NOW() | æ¶ˆæ¯æ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- KEY `idx_user_session` (`user_id`, `session_id`, `timestamp`)

**SQLè„šæœ¬**ï¼š`chat_message.sql`

---

### 4. user_memoryï¼ˆç”¨æˆ·è®°å¿†è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨AIæå–çš„ç”¨æˆ·ç”»åƒå’Œäº‹å®è®°å¿†

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | è®°å¿†ID |
| user_id | BIGINT | NOT NULL, FK | ç”¨æˆ·ID |
| fact_key | VARCHAR(100) | NOT NULL | äº‹å®é”® |
| fact_value | TEXT | NOT NULL | äº‹å®å€¼ |
| fact_type | VARCHAR(50) | | è®°å¿†ç±»å‹ |
| source_message_id | BIGINT | FK | æ¥æºæ¶ˆæ¯ID |
| created_at | TIMESTAMP | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| last_accessed_at | TIMESTAMP | | æœ€åè®¿é—®æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_user_fact` (`user_id`, `fact_key`)

**SQLè„šæœ¬**ï¼š`user_memory.sql`

---

### 5. ai_model_configï¼ˆAIæ¨¡å‹é…ç½®è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨AIæ¨¡å‹é…ç½®ï¼Œæ”¯æŒçƒ­åˆ‡æ¢

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”®ID |
| model_name | VARCHAR(100) | UNIQUE, NOT NULL | æ¨¡å‹åç§° |
| base_url | VARCHAR(255) | NOT NULL | APIåŸºç¡€URL |
| api_key | VARCHAR(255) | NOT NULL | APIå¯†é’¥ |
| completions_path | VARCHAR(100) | DEFAULT '/chat/completions' | å®Œæˆæ¥å£è·¯å¾„ |
| is_active | TINYINT(1) | DEFAULT 0 | æ˜¯å¦æ¿€æ´» |
| enable_thinking | TINYINT(1) | DEFAULT 0 | æ˜¯å¦å¯ç”¨æ·±åº¦æ€è€ƒ |
| description | VARCHAR(255) | | æ¨¡å‹æè¿° |
| create_time | DATETIME | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | ON UPDATE NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_model_name` (`model_name`)

**SQLè„šæœ¬**ï¼š`ai_model_config.sql`

---

### 6. ai_prompt_configï¼ˆAIæç¤ºè¯é…ç½®è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç³»ç»Ÿæç¤ºè¯ã€æ€§æ ¼ã€è¯­æ°”é£æ ¼é…ç½®

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”®ID |
| config_key | VARCHAR(100) | UNIQUE, NOT NULL | é…ç½®é”® |
| config_value | TEXT | NOT NULL | é…ç½®å€¼ |
| description | VARCHAR(255) | | æè¿° |
| config_type | INT | DEFAULT 0 | ç±»å‹ï¼š0ç³»ç»Ÿ/1æ€§æ ¼/2è¯­æ°” |
| create_time | DATETIME | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | ON UPDATE NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_config_key` (`config_key`)

**SQLè„šæœ¬**ï¼š`ai_prompt_config.sql`

---

### 7. question_exampleï¼ˆé¢˜ç›®ç¤ºä¾‹è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨å„ç§‘ç›®ã€å„é¢˜å‹çš„ç¤ºä¾‹é¢˜ç›®ï¼Œç”¨äºAI few-shotå­¦ä¹ 

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”®ID |
| subject | VARCHAR(50) | NOT NULL | ç§‘ç›® |
| question_type | VARCHAR(50) | NOT NULL | é¢˜å‹ |
| difficulty | VARCHAR(20) | NOT NULL | éš¾åº¦ |
| content | JSON | NOT NULL | é¢˜ç›®JSON |
| description | VARCHAR(255) | | æè¿° |
| created_at | TIMESTAMP | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | ON UPDATE NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- KEY `idx_subject_type_difficulty` (`subject`, `question_type`, `difficulty`)

**SQLè„šæœ¬**ï¼š`question_example.sql`

---

### 8. question_generation_recordï¼ˆé¢˜ç›®ç”Ÿæˆè®°å½•è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·é¢˜ç›®ç”Ÿæˆå†å²è®°å½•

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”®ID |
| user_id | BIGINT | NOT NULL, FK | ç”¨æˆ·ID |
| subject | VARCHAR(50) | NOT NULL | ç§‘ç›® |
| question_type | VARCHAR(50) | NOT NULL | é¢˜å‹ |
| theme | VARCHAR(100) | | ä¸»é¢˜ |
| difficulty | VARCHAR(20) | NOT NULL | éš¾åº¦ |
| quantity | INT | NOT NULL | æ•°é‡ |
| generated_questions | JSON | NOT NULL | ç”Ÿæˆçš„é¢˜ç›®JSON |
| created_at | TIMESTAMP | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | ON UPDATE NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- KEY `idx_user_created` (`user_id`, `created_at` DESC)

**SQLè„šæœ¬**ï¼š`question_generation_record.sql`

---

### 9. question_categoryï¼ˆé¢˜ç›®åˆ†ç±»è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨é¢˜ç›®åˆ†ç±»ä¿¡æ¯ï¼ˆç§‘ç›®ã€é¢˜å‹ç­‰ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”®ID |
| name | VARCHAR(50) | NOT NULL | åˆ†ç±»åç§° |
| code | VARCHAR(50) | UNIQUE, NOT NULL | åˆ†ç±»ç¼–ç  |
| parent_id | BIGINT | DEFAULT 0 | çˆ¶çº§ID |
| category_type | INT | NOT NULL | ç±»å‹ 1:ç§‘ç›® 2:é¢˜å‹ 3:å¥—å· |
| sort_order | INT | DEFAULT 0 | æ’åº |
| create_time | DATETIME | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | ON UPDATE NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_code` (`code`)
- KEY `idx_parent_id` (`parent_id`)

**SQLè„šæœ¬**ï¼š`question_category.sql`

---

### 10. paper_generation_recordï¼ˆå¥—å·ç”Ÿæˆè®°å½•è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·ç”Ÿæˆçš„æ•´å¥—è¯•å·è®°å½•

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”®ID |
| user_id | BIGINT | NOT NULL, FK | ç”¨æˆ·ID |
| subject_id | BIGINT | NOT NULL, FK | ç§‘ç›®ID |
| paper_name | VARCHAR(100) | NOT NULL | å¥—å·åç§° |
| total_questions | INT | NOT NULL | æ€»é¢˜ç›®æ•°é‡ |
| enable_thinking | TINYINT(1) | DEFAULT 0 | æ˜¯å¦å¯ç”¨æ·±åº¦æ€è€ƒ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | ON UPDATE | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- KEY `idx_user_created` (`user_id`, `created_at` DESC)

**SQLè„šæœ¬**ï¼š`paper_generation_record.sql`

---

### 11. paper_question_detailï¼ˆå¥—å·é¢˜ç›®æ˜ç»†è¡¨ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨æ¯ä¸ªå¥—å·ä¸­å„ä¸ªé¢˜å‹çš„å…·ä½“é¢˜ç›®å†…å®¹

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”®ID |
| paper_id | BIGINT | NOT NULL, FK | å¥—å·ID |
| question_type | VARCHAR(50) | NOT NULL | é¢˜å‹ç¼–ç  |
| question_type_name | VARCHAR(50) | NOT NULL | é¢˜å‹åç§° |
| difficulty | VARCHAR(20) | NOT NULL | éš¾åº¦ |
| quantity | INT | NOT NULL | é¢˜ç›®æ•°é‡ |
| theme | VARCHAR(100) | | ä¸»é¢˜ |
| generated_questions | JSON | NOT NULL | ç”Ÿæˆçš„é¢˜ç›®JSON |
| display_order | INT | NOT NULL | æ˜¾ç¤ºé¡ºåº |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY (`id`)
- INDEX `idx_paper_order` (`paper_id`, `display_order`)

**SQLè„šæœ¬**ï¼š`paper_question_detail.sql`

---

## ğŸ”— è¡¨å…³ç³»è¯´æ˜

### ä¸€å¯¹å¤šå…³ç³»

1. **user_account â†’ chat_session**  
   ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªä¼šè¯

2. **user_account â†’ chat_message**  
   ä¸€ä¸ªç”¨æˆ·å¯ä»¥å‘é€å¤šæ¡æ¶ˆæ¯

3. **chat_session â†’ chat_message**  
   ä¸€ä¸ªä¼šè¯åŒ…å«å¤šæ¡æ¶ˆæ¯

4. **user_account â†’ user_memory**  
   ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šæ¡è®°å¿†

5. **user_account â†’ question_generation_record**  
   ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šæ¡å‡ºé¢˜è®°å½•

6. **question_category (Self) â†’ question_category**
   åˆ†ç±»è¡¨è‡ªå…³è”ï¼ˆçˆ¶å­çº§å…³ç³»ï¼‰

7. **user_account â†’ paper_generation_record**
   ä¸€ä¸ªç”¨æˆ·å¯ä»¥ç”Ÿæˆå¤šå¥—è¯•å·

8. **paper_generation_record â†’ paper_question_detail**
   ä¸€å¥—è¯•å·åŒ…å«å¤šä¸ªé¢˜å‹æ˜ç»†

9. **question_category â†’ paper_generation_record**
   å¥—å·é€šè¿‡ subject_id å…³è”ç§‘ç›®åˆ†ç±»

## ğŸ“ åˆå§‹åŒ–è„šæœ¬æ‰§è¡Œé¡ºåº

1. `user_account.sql` - ç”¨æˆ·è¡¨ï¼ˆåŸºç¡€è¡¨ï¼‰
2. `chat_session.sql` - ä¼šè¯è¡¨
3. `chat_message.sql` - æ¶ˆæ¯è¡¨
4. `user_memory.sql` - è®°å¿†è¡¨
5. `ai_model_config.sql` - æ¨¡å‹é…ç½®è¡¨
6. `ai_prompt_config.sql` - æç¤ºè¯é…ç½®è¡¨
7. `question_category.sql` - é¢˜ç›®åˆ†ç±»è¡¨
8. `question_example.sql` - é¢˜ç›®ç¤ºä¾‹è¡¨
9. `question_generation_record.sql` - å‡ºé¢˜è®°å½•è¡¨
10. `paper_generation_record.sql` - å¥—å·è®°å½•è¡¨
11. `paper_question_detail.sql` - å¥—å·æ˜ç»†è¡¨

## ğŸ”§ æ•°æ®åº“ä¼˜åŒ–å»ºè®®

### ç´¢å¼•ä¼˜åŒ–

- ä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- ç»„åˆç´¢å¼•æŒ‰æŸ¥è¯¢é¡ºåºæ’åˆ—
- å®šæœŸåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨è¿æ¥æ± ï¼ˆHikariCPï¼‰
- å¯ç”¨æŸ¥è¯¢ç¼“å­˜
- å®šæœŸæ¸…ç†å†å²æ•°æ®

### å¤‡ä»½ç­–ç•¥

- æ¯æ—¥å…¨é‡å¤‡ä»½
- å®æ—¶binlogå¤‡ä»½
- å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ¦‚è§ˆ](file:///C:/Users/35666/.gemini/antigravity/brain/774ebe23-99e1-46d9-a3e1-52263e77b58e/é¡¹ç›®æ¦‚è§ˆ.md)
- SQLè„šæœ¬ä½ç½®ï¼š`src/main/resources/static/`
