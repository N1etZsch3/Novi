# AI 出题功能开发任务清单

## 📋 需求概述

扩展项目，增加AI智能出题功能，支持：

- 前端传递出题配置（科目、题型、主题、难度、数量）
- 后端动态组装提示词并调用AI生成题目
- 返回JSON格式的题目数据给前端渲染
- 保存用户出题记录到数据库
- 提供历史记录列表查询

------

## 🗄️ 数据库设计层

### [ ] 1. 设计题库示例表结构

-  创建通用题库示例表 `question_example`
  - 字段：id, subject（科目）, question_type（题型）, difficulty（难度）, content（题目JSON）, created_at
  - 用于存储各科目、各题型的示例题目，供AI few-shot学习
-  或者根据科目创建独立表（如 `question_example_english`, `question_example_math` 等）
  - 决策点：评估是统一表还是分科目表更合理

### [ ] 2. 设计出题历史记录表

-  创建 `question_generation_record` 表
  - id（主键，自增）
  - user_id（用户ID，外键关联 user_account）
  - subject（科目）
  - question_type（题型）
  - theme（主题，可为空）
  - difficulty（难度）
  - quantity（数量）
  - generated_questions（生成的题目JSON）
  - created_at（创建时间）
  - updated_at（更新时间）
-  创建索引优化查询性能
  - idx_user_created (user_id, created_at DESC)

### [ ] 3. 编写SQL初始化脚本

-  创建 `question_example.sql`
-  创建 `question_generation_record.sql`
-  准备示例数据（如湖北专升本英语的语法填空、阅读理解等示例题目）

------

## 🔧 后端开发层

### [ ] 4. 创建实体类（PO）

-  `QuestionExample.java`（题库示例实体）
-  `QuestionGenerationRecord.java`（出题记录实体）

### [ ] 5. 创建数据访问层（Mapper）

-  `QuestionExampleMapper.java`
  - 根据科目、题型、难度查询示例题目
-  `QuestionGenerationRecordMapper.java`
  - 保存出题记录
  - 根据用户ID查询历史记录列表

### [ ] 6. 创建DTO对象

-  `QuestionGenerationRequest.java`（前端请求参数）
  - subject（科目）
  - questionType（题型）
  - theme（主题，可选）
  - difficulty（难度）
  - quantity（数量）
-  `QuestionGenerationResponse.java`（返回给前端的响应）
  - recordId（记录ID）
  - questions（题目列表JSON）
-  `QuestionHistoryItem.java`（历史记录列表项）
  - id, subject, questionType, theme, difficulty, quantity, createdAt

### [ ] 7. 创建Service业务逻辑层

-  `QuestionGenerationService.java`接口和实现类
  - `generateQuestions(userId, request)`：核心出题逻辑
    - 1. 根据科目、题型从数据库查询示例题目
    - 1. 动态组装AI提示词
    - 1. 调用AI API获取JSON结果
    - 1. 解析JSON并返回
    - 1. 保存出题记录到数据库
  - `getGenerationHistory(userId)`：获取用户出题历史
  - `getRecordDetail(recordId, userId)`：获取单条记录详情

### [ ] 8. 实现AI提示词动态组装逻辑

-  创建 `QuestionPromptBuilder.java` 工具类
  - 根据科目、题型、难度、示例题目动态构建提示词
  - 支持不同题型的特定提示词模板
  - 整合主题信息到提示词中

### [ ] 9. 创建Controller控制器

-  `QuestionGenerationController.java`
  - `POST /api/v1/questions/generate`：生成题目
  - `GET /api/v1/questions/history`：获取历史记录列表
  - `GET /api/v1/questions/history/{recordId}`：获取单条记录详情

### [ ] 10. 异常处理与验证

-  添加请求参数校验（@Validated）
-  处理AI调用失败的情况
-  处理JSON解析异常

------

## 🎨 前端开发层

### [ ] 11. 创建出题配置界面

-  设计题目生成配置表单
  - 科目下拉选择框
  - 题型下拉选择框（根据科目动态变化）
  - 主题输入框（部分题型显示）
  - 难度选择（简单/中等/困难）
  - 数量输入框
-  创建提交按钮，调用后端API

### [ ] 12. 创建题目展示界面

-  接收后端返回的JSON数据
-  渲染不同题型的题目（选择题、填空题、阅读理解等）
-  支持导出功能（可选）

### [ ] 13. 创建历史记录列表界面

-  类似会话列表的UI设计
-  显示历史记录卡片
  - 科目、题型、难度、数量、创建时间
-  点击记录查看详情（重新加载题目）

### [ ] 14. 前后端联调

-  测试出题功能流程
-  测试历史记录查询功能
-  测试不同科目、题型的生成效果

------

## 🧪 测试层

### [ ] 15. 编写单元测试

-  `QuestionGenerationServiceTest.java`
  - 测试提示词组装逻辑
  - 测试JSON解析逻辑
  - 测试数据保存逻辑

### [ ] 16. 编写集成测试

-  `QuestionGenerationControllerTest.java`
  - 测试API接口

------

## 📝 文档与优化

### [ ] 17. 更新项目文档

-  更新 README.md，添加出题功能说明
-  更新数据库文档，补充新增表结构说明

### [ ] 18. 性能优化考虑

-  AI调用超时处理
-  示例题目缓存策略
-  历史记录分页查询

------

## 🚀 部署与验证

### [ ] 19. 部署前准备

-  执行SQL脚本建表
-  准备示例题库数据

### [ ] 20. 功能验证

-  测试完整的出题流程
-  验证历史记录功能
-  验证不同科目、题型的适配