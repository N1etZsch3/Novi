# Novi 项目概览文档

## 📖 项目简介

**Novi（挚友）** 是一个基于 **Spring Boot 3** 和 **Spring AI** 构建的智能对话后端系统。该项目旨在通过长期记忆和个性化偏好，为用户提供具有连贯性、同理心和独特人格的 AI 伴侣体验。

**项目愿景**：让 AI 不仅仅是工具，更是独一无二的挚友。

## 🛠️ 技术栈

| 技术分类 | 使用技术 | 版本 |
|---------|---------|------|
| **核心框架** | Spring Boot | 3.5.7 |
| **Java版本** | Java | 21 |
| **AI框架** | Spring AI | 1.0.3 |
| **数据库** | MySQL | 8.0+ |
| **ORM框架** | MyBatis-Plus | 3.5.7 |
| **安全认证** | Spring Security + JWT | - |
| **环境配置** | Spring Dotenv | 4.0.0 |
| **构建工具** | Maven | - |

## ✨ 核心功能模块

### 1. 用户管理模块
- 用户账号注册与登录
- JWT 无状态认证
- 密码加密（BCrypt）
- 用户偏好配置管理

### 2. AI 聊天模块
- **双模式响应**：
  - 阻塞式调用：一次性返回完整结果
  - 流式响应（SSE）：实时推送，打字机效果
- **上下文记忆**：基于数据库的持久化聊天记忆
- **多轮对话支持**：AI 能记住之前的聊天内容

### 3. AI 模型配置模块
- 支持多个 AI 模型配置管理
- 动态模型切换（热切换）
- 模型配置的增删改查
- 当前激活模型管理

### 4. AI 提示词管理模块
- 系统提示词配置
- AI 性格配置（如毒舌、温柔等）
- 语气风格配置
- 动态提示词组装

### 5. 会话管理模块
- 会话自动创建与识别
- 会话标题自动生成
- 会话历史查询
- 会话软删除

### 6. 问题生成模块
- 支持多科目题目生成
- 支持多种题型（选择题、填空题、阅读理解等）
- 基于示例题目的 AI 生成
- 题目生成历史记录

## 🏗️ 系统架构

### 项目目录结构

```
Novi
├── novi-common          # 公共模块 (Utils, DTOs, Exceptions)
├── novi-user            # 用户模块 (User Service & Mapper)
├── novi-ai-config       # AI配置模块 (Model & Prompt Config)
├── novi-chat            # 聊天核心模块 (Chat Service & Memory)
├── novi-question        # 出题模块 (Question Generation)
├── novi-view            # 前端视图模块 (Static Resources)
└── novi-web             # Web启动模块 (Controllers & Application)
```

### 控制器层（Controller）

| 控制器 | 路径 | 功能描述 |
|--------|------|---------|
| `ChatController` | `/api/v1/chat` | AI 聊天功能（阻塞式和流式） |
| `ChatSessionController` | `/api/v1/sessions` | 会话管理 |
| `UserAccountController` | `/api/v1/users` | 用户账号管理 |
| `UserPreferenceController` | `/api/v1/preferences` | 用户偏好配置 |
| `AiModelConfigController` | `/api/model/config` | AI 模型配置管理 |
| `AiPromptConfigController` | `/api/prompt/config` | AI 提示词配置管理 |

### 服务层（Service）

| 服务 | 功能描述 |
|------|---------|
| `ChatService` | 聊天流程编排、消息处理 |
| `ChatSessionService` | 会话创建、查询、删除 |
| `UserAccountService` | 用户注册、登录、认证 |
| `UserPreferenceService` | 用户偏好管理 |
| `AiModelConfigService` | AI 模型配置管理 |
| `AiPromptConfigService` | 提示词配置管理 |
| `QuestionGenerationService` | 问题生成服务 |

### 数据访问层（Mapper）

| Mapper | 对应表 |
|--------|--------|
| `UserAccountMapper` | `user_account` |
| `ChatSessionMapper` | `chat_session` |
| `ChatMemoryMapper` | `chat_message` |
| `UserMemoryMapper` | `user_memory` |
| `AiModelConfigMapper` | `ai_model_config` |
| `AiPromptConfigMapper` | `ai_prompt_config` |
| `QuestionExampleMapper` | `question_example` |
| `QuestionGenerationRecordMapper` | `question_generation_record` |

## 🗄️ 数据库设计

### 核心数据表

| 表名 | 功能描述 |
|------|---------|
| `user_account` | 用户账号信息 |
| `chat_session` | 聊天会话元数据 |
| `chat_message` | 聊天消息内容 |
| `user_memory` | 用户画像/事实记忆 |
| `ai_model_config` | AI 模型配置 |
| `ai_prompt_config` | AI 提示词配置 |
| `ai_prompt_context_config` | 提示词上下文配置 |
| `question_example` | 题目示例库 |
| `question_generation_record` | 题目生成历史 |

## 🚀 快速开始

### 环境要求
- JDK 21+
- MySQL 8.0+
- Maven 3.8+

### 配置步骤

1. **创建数据库**
   ```sql
   CREATE DATABASE novi CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

2. **执行 SQL 脚本**
   
   按顺序执行 `src/main/resources/static/` 下的 SQL 文件：
   - `user_account.sql`
   - `chat_session.sql`
   - `chat_message.sql`
   - `user_memory.sql`
   - `ai_model_config.sql`
   - `ai_prompt_config.sql`
   - `question_example.sql`
   - `question_generation_record.sql`

3. **配置环境变量**
   
   在项目根目录创建 `.env` 文件：
   ```env
   SPRING_DATASOURCE_URL=jdbc:mysql://localhost:3306/novi
   SPRING_DATASOURCE_USERNAME=your_username
   SPRING_DATASOURCE_PASSWORD=your_password
   AI_API_KEY=your_ai_api_key
   ```

4. **启动项目**
   ```bash
   mvn spring-boot:run
   ```
   
   服务默认启动在 `http://localhost:8080`

## 📚 相关文档

- [设计思路文档](file:///c:/Study/Novi/docs/设计思路.md)
- [重构报告](file:///c:/Study/Novi/docs/重构报告.md)
- [新增需求说明](file:///c:/Study/Novi/新增需求.md)
- [接口文档目录](file:///c:/Study/Novi/docs/接口文档/)

## 👨‍💻 开发者

- **作者**：N1etzsch3
- **项目名称**：Novi（挚友）
- **版本**：0.0.1-SNAPSHOT
