<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>试卷导出预览 - Novi Style</title>
    <style>
        /* ================= 基础重置 ================= */
        body {
            background-color: #f2f4f7;
            margin: 0;
            padding: 40px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
        }

        /* ================= A4 纸张模拟 (核心导出区域) ================= */
        /* 注意：这里所有的样式都尽量使用了兼容性最好的写法，方便后续导出 Word */
        .paper-card {
            width: 210mm; /* A4 宽度 */
            min-height: 297mm; /* A4 高度 */
            background-color: #ffffff;
            padding: 25.4mm 31.8mm; /* 标准 Word 页边距 (上下2.54cm, 左右3.18cm) */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            box-sizing: border-box;
            color: #000;
            font-family: "Times New Roman", "SimSun", serif; /* 核心：衬线字体 */
        }

        /* 标题区 */
        .paper-title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            font-family: "SimHei", "Times New Roman", sans-serif; /* 黑体标题 */
            margin-bottom: 10px;
        }

        .paper-meta {
            text-align: center;
            font-size: 14px;
            color: #444;
            margin-bottom: 30px;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
        }

        .meta-item {
            margin: 0 10px;
        }

        /* 大题标题 */
        .question-block {
            margin-bottom: 25px;
        }

        .block-title {
            font-size: 16px;
            font-weight: bold;
            font-family: "SimHei", serif;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .instruction {
            font-weight: normal;
            font-size: 14px;
            font-style: italic;
        }

        /* 内容文本 */
        .question-content {
            font-size: 15px;
            line-height: 1.8; /* 宽松行距 */
            text-align: justify; /* 两端对齐 */
        }

        .question-content p {
            text-indent: 2em;
            margin: 0 0 10px 0;
        }

        /* ================= 静态填空样式 (核心) ================= */

        /* 1. 小题填空 (语法填空/阅读填空) */
        .static-blank {
            display: inline-block;
            min-width: 60px;
            border-bottom: 1px solid #000; /* 下划线 */
            text-align: center;
            margin: 0 4px;
            font-family: "Courier New", monospace;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }

        /* 2. 序号样式 (语法填空前面的 [1]) */
        .blank-index {
            font-weight: bold;
            margin-right: 2px;
            font-family: "Times New Roman", serif;
        }

        /* 3. 作文/大题留白 */
        .essay-area {
            margin-top: 15px;
            border: 1px dashed #ccc;
            padding: 15px;
            background-color: #fcfcfc;
        }
        .essay-line {
            border-bottom: 1px solid #e0e0e0;
            height: 30px;
            margin-bottom: 5px;
        }

        /* 4. 连词成句/单行书写线 */
        .write-line {
            display: block;
            margin-top: 8px;
            border-bottom: 1px solid #000;
            height: 20px;
            width: 100%;
        }

        /* ================= 阅读理解特殊布局 ================= */
        .divider-line {
            border-top: 1px dashed #000;
            margin: 20px 0;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        .summary-box, .qa-box {
            padding-left: 10px;
        }

        /* ================= 答案区 ================= */
        .answer-section {
            margin-top: 50px;
            page-break-before: always; /* 打印时强制分页 */
            border-top: 2px dashed #999;
            padding-top: 20px;
        }

        table.answer-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 15px;
        }

        table.answer-table th, table.answer-table td {
            border: 1px solid #000;
            padding: 8px;
        }

        table.answer-table th {
            background-color: #eee;
            text-align: center;
            font-weight: bold;
        }

        /* 题号列 */
        .col-idx { width: 10%; text-align: center; }
        /* 答案列 */
        .col-ans { width: 30%; font-weight: bold; }
        /* 解析列 */
        .col-ana { width: 60%; color: #444; }

    </style>
</head>
<body>

<div class="paper-card" id="paper-render-target">
</div>

<script>
    // 1. 你的 JSON 数据 (完全复制你的结构)
    const examData = [
        {
            "id": "part1_grammar",
            "ui_type": "cloze_passage",
            "title": "Part Ⅰ 语法填空",
            "instruction": "阅读下面短文，在空白处填入括号内提示词的正确形式。",
            "stem": "<p>Chinese architect, Liu Jiakun won the 2025 Pritzker Architecture Prize on the 4th of March. This is the [[__1__]] (big) award of all in architecture. He is the second person from China to win it. Liu lives in Chengdu and has worked [[__2__]] 40 years. In 1999, he [[__3__]] (start) his company, Jiakun Architects, and has completed over 30 projects, including small museums, big buildings, [[__4__]] city plans.</p><p>Liu does not follow one style. He uses local materials and simple designs to make [[__5__]] (beauty) buildings. After the 2008 Wenchuan earthquake, Liu made “rebirth bricks” from broken buildings — a symbol of hope. Liu also [[__6__]] (design) for ordinary people. For example, West Village in Chengdu, [[__7__]] (finish) in 2015, has a soccer field, a market and paths for running, [[__8__]] (walk), and cycling. Grass grows through the bricks, showing the beauty of daily life. Many people enjoy visiting this place. “The purpose of architecture is to create [[__9__]] pleasant and wonderful environment. People’s [[__10__]] (happy) is what we work for,” he said.</p>",
            "answers": [
                { "index": 1, "correct": "biggest", "analysis": "最高级形式" },
                { "index": 2, "correct": "for", "analysis": "for + 时间段" },
                { "index": 3, "correct": "started", "analysis": "1999年是一般过去时" },
                // ... 省略部分答案以便演示
            ]
        },
        {
            "id": "part2_sort_11",
            "ui_type": "sort_sentence",
            "title": "Part II 连词成句",
            "instruction": "将下列单词连成句子。",
            "stem": "her homework / She / has completed",
            "answer": { "correct": "She has completed her homework.", "analysis": "现在完成时" }
        },
        {
            "id": "part2_sort_12",
            "ui_type": "sort_sentence",
            "stem": "your plan / tell me / Can you",
            "answer": { "correct": "Can you tell me your plan?", "analysis": "一般疑问句" }
        },
        {
            "id": "part3_reading_gap",
            "ui_type": "reading_cloze",
            "title": "Part Ⅲ 阅读理解 (填空)",
            "instruction": "根据文章内容完成填空，每空填1个词。",
            "stem": "<div class='reading-content'><p>The Dong Grand Choir (侗族大歌) is a unique musical tradition of the Dong people in China. For centuries, the Dong people, who live in mountain villages of Guizhou, Guangxi, and Hunan, have used these songs to share stories, teach moral values, and celebrate nature. Unlike most choirs, there is no conductor (指挥) or written music — the harmony is created naturally by singers of all ages.</p></div><div class='divider-line'>- Questions -</div><div class='summary-box'><h3>The Dong Grand Choir Summary</h3><ul><li><strong>Type of Tradition:</strong> The Dong Grand Choir is a unique [[__17__]] tradition of the Dong people in China.</li><li><strong>Unique Feature:</strong> Unlike most choirs, the Dong Grand Choir has no conductor or [[__18__]] music.</li></ul></div>",
            "answers": [
                { "index": 17, "correct": "musical", "analysis": "细节题" },
                { "index": 18, "correct": "written", "analysis": "细节题" }
            ]
        },
        {
            "id": "part4_reading_qa",
            "ui_type": "reading_qa",
            "title": "Part Ⅳ 阅读理解 (问答)",
            "instruction": "阅读下面短文，回答问题或将句子翻译成中文。",
            "stem": "<div class='reading-content'><p>Anna and her girl friends decided to take a journey along the river’s path. They rented a small boat and packed food, drinks, and blankets for the day.</p></div><div class='divider-line'>- Questions -</div><div class='qa-box'><p>27. What did Anna and her girl friends pack for their boat journey?</p>[[__textarea_27__]]<p>31. Translate the sentence “Afterwards, they continued their journey...” into Chinese.</p>[[__textarea_31__]]</div>",
            "answers": [
                { "index": 27, "correct": "Food, drinks, and blankets.", "analysis": "细节题" },
                { "index": 31, "correct": "后来，她们继续旅程...", "analysis": "翻译" }
            ]
        },
        {
            "id": "part6_writing",
            "ui_type": "essay",
            "title": "Part Ⅵ 书面表达",
            "instruction": "请根据要求完成邮件写作。",
            "stem": "<p><strong>题目：</strong>国外某艺术团希望参加2025年在东湖举行的音乐节。假设你是组委会的工作人员李华，请你用英语给他们发一封邮件。</p><ul><li>（1）表示欢迎；</li><li>（2）活动将于7月18号至20日举行；</li><li>（3）请他们准备2-3个节目参加表演。</li></ul>[[__textarea_43__]]",
            "answer": { "correct": "Dear Sir/Madam...", "analysis": "略" }
        }
    ];

    // 2. 核心渲染函数
    function renderPaper(data) {
        const container = document.getElementById('paper-render-target');
        let html = '';
        let allAnswers = [];

        // (1) 渲染试卷头
        html += `
                <div class="paper-title">2025年英语模拟考试真题</div>
                <div class="paper-meta">
                    <span class="meta-item">科目：英语</span>
                    <span class="meta-item">|</span>
                    <span class="meta-item">适用对象：专升本</span>
                    <span class="meta-item">|</span>
                    <span class="meta-item">总分：100分</span>
                </div>
            `;

        // (2) 循环渲染题目 Block
        data.forEach((block, index) => {
            html += `<div class="question-block">`;

            // 渲染标题 (如果该 Block 有标题)
            if (block.title) {
                html += `<div class="block-title">${block.title} <span class="instruction">(${block.instruction || ''})</span></div>`;
            }

            // 根据 ui_type 处理内容
            let contentHtml = '';

            // === 模式 A: 连词成句 (特殊处理) ===
            if (block.ui_type === 'sort_sentence') {
                // 如果没有大标题，这里手动加个小题号
                const seq = block.answer_id ? block.answer_id.replace(/\D/g, '') : (index + 1);
                contentHtml = `
                        <div class="question-content">
                            <div><strong>${seq}.</strong> ${block.stem}</div>
                            <div class="write-line"></div>
                        </div>
                    `;
                // 收集答案
                if (block.answer) allAnswers.push({ id: seq, ...block.answer });
            }

            // === 模式 B: 富文本处理 (语法填空、阅读、作文) ===
            else {
                // 核心：处理占位符
                let rawContent = block.stem;

                // 1. 处理多行文本域 [[__textarea_id__]] -> 渲染为横线格
                rawContent = rawContent.replace(/\[\[__textarea_(\d+)__\]\]/g, (match, id) => {
                    return `<div class="essay-area">
                            <div class="essay-line"></div>
                            <div class="essay-line"></div>
                            <div class="essay-line"></div>
                        </div>`;
                });

                // 2. 处理单行填空 [[__id__]] -> 渲染为下划线
                // 如果是 cloz_passage (语法填空)，通常要在下划线前显示题号 [1]
                rawContent = rawContent.replace(/\[\[__(\d+)__\]\]/g, (match, id) => {
                    const showIndex = block.ui_type === 'cloze_passage' || block.ui_type === 'reading_cloze';
                    const label = showIndex ? `<span class="blank-index">[${id}]</span>` : '';
                    // 空白处，如果是 Word 导出，可以用 "__________"
                    return `${label}<span class="static-blank">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>`;
                });

                contentHtml = `<div class="question-content">${rawContent}</div>`;

                // 收集答案 (数组形式)
                if (block.answers) {
                    block.answers.forEach(a => allAnswers.push({ id: a.index, correct: a.correct, analysis: a.analysis }));
                } else if (block.answer) {
                    // 单个答案
                    allAnswers.push({ id: '写作', correct: '见解析', analysis: block.answer.correct });
                }
            }

            html += contentHtml;
            html += `</div>`; // End question-block
        });

        // (3) 渲染答案区
        if (allAnswers.length > 0) {
            html += `<div class="answer-section">`;
            html += `<div class="paper-title" style="font-size:18px;">参考答案与解析</div>`;
            html += `<table class="answer-table"><thead><tr><th class="col-idx">题号</th><th class="col-ans">答案</th><th class="col-ana">解析</th></tr></thead><tbody>`;

            // 简单排序 (如果是纯数字)
            allAnswers.sort((a, b) => parseInt(a.id) - parseInt(b.id));

            allAnswers.forEach(ans => {
                html += `<tr>
                        <td class="col-idx">${ans.id}</td>
                        <td class="col-ans">${ans.correct}</td>
                        <td class="col-ana">${ans.analysis}</td>
                    </tr>`;
            });

            html += `</tbody></table></div>`;
        }

        container.innerHTML = html;
    }

    // 执行渲染
    renderPaper(examData);
</script>
</body>
</html>