<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI出题系统 - 阅读理解渲染 (含标题)</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* --- 基础布局 --- */
        body, html { margin: 0; padding: 0; height: 100%; font-family: "Segoe UI", sans-serif; overflow: hidden; background: #1e1e1e; }
        #app { display: flex; height: 100vh; width: 100vw; }

        /* 左侧编辑器 */
        .editor-pane { width: 35%; display: flex; flex-direction: column; border-right: 1px solid #333; background: #1e1e1e; }
        .editor-header { padding: 10px 15px; background: #252526; color: #ccc; font-size: 13px; font-weight: bold; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;}
        .json-input { flex: 1; background: #1e1e1e; color: #ce9178; border: none; padding: 15px; font-family: "Consolas", "Monaco", monospace; font-size: 13px; resize: none; outline: none; line-height: 1.5; }
        .error-bar { background: #c72e2e; color: white; padding: 5px 15px; font-size: 12px; }

        /* 右侧预览 */
        .preview-pane { width: 65%; background: #eef2f5; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }

        /* 试卷纸张 */
        .paper-sheet {
            width: 100%; max-width: 820px; background: white; padding: 60px 70px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); min-height: 1000px; color: #000;
            font-family: "Times New Roman", "SimSun", serif;
        }

        .q-header { border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 25px; }
        .q-title { font-size: 20px; font-weight: bold; }
        .q-meta { font-size: 14px; color: #555; margin-top: 5px; font-family: Arial, sans-serif; }

        /* --- 核心内容渲染样式 --- */
        .q-content {
            font-size: 16px;
            line-height: 1.8;
            white-space: pre-wrap; /* 关键：保留换行 */
            text-align: justify;
        }

        /* 占位符样式 */
        .u-blank { display: inline-block; color: #000; font-family: Arial, sans-serif; letter-spacing: -1px; padding: 0 2px; }
        .u-index { font-weight: bold; margin-right: 2px; }

        /* --- 新增：Subtitle 样式 --- */
        .u-subtitle {
            display: block;        /* 独占一行 */
            text-align: center;    /* 居中 */
            font-weight: bold;     /* 加粗 */
            font-size: 18px;       /* 字号稍大 */
            margin: 20px 0 10px 0; /* 上下边距 */
            font-family: Arial, sans-serif; /* 标题通常用无衬线体区别于正文 */
        }

        /* --- 新增：Indent (缩进) 样式 --- */
        .u-indent {
            display: inline-block;
            width: 2em; /* 标准缩进：2个字符宽度 */
        }

        /* 解析区域 */
        .analysis-box { margin-top: 40px; padding-top: 20px; border-top: 1px dashed #ccc; }
        .ans-row { margin-bottom: 10px; font-size: 14px; font-family: Arial, sans-serif; }
        .tag { background: #eee; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 12px; margin-right: 8px; border: 1px solid #ddd; }

        .btn-toggle { position: fixed; top: 20px; right: 40px; background: #2c3e50; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn-toggle:hover { background: #34495e; }
    </style>
</head>
<body>

<div id="app">
    <div class="editor-pane">
        <div class="editor-header">
            <span>JSON Editor</span>
            <button @click="resetJSON" style="font-size:12px;cursor:pointer;">Reset</button>
        </div>
        <textarea class="json-input" v-model="jsonStr"></textarea>
        <div class="error-bar" v-if="errorMsg">{{ errorMsg }}</div>
    </div>

    <div class="preview-pane">
        <button class="btn-toggle" @click="showAnalysis = !showAnalysis">
            {{ showAnalysis ? 'Hide Analysis' : 'Show Analysis' }}
        </button>

        <div class="paper-sheet" v-if="parsedData">
            <div class="q-header">
                <div class="q-title">{{ parsedData.title }}</div>
                <div class="q-meta">
                    <span style="margin-right:20px;">{{ parsedData.score_desc }}</span>
                    <span>难度: {{ parsedData.difficulty }}</span>
                </div>
            </div>

            <div class="q-content" v-html="renderedHtml"></div>

            <div class="analysis-box" v-if="showAnalysis">
                <h4 style="margin:0 0 15px 0;">参考答案与解析</h4>
                <div v-for="key in sortedKeys" :key="key" class="ans-row">
                    <strong>{{ key }}.</strong>
                    <span class="tag">Ans</span> {{ parsedData.answers[key] }}
                    <br>
                    <span style="color:#666; margin-left: 28px;">{{ parsedData.analyses[key] }}</span>
                </div>
            </div>
        </div>
        <div v-else style="margin-top:50px; color:#666">Invalid JSON Data</div>
    </div>
</div>

<script>
    const { createApp, ref, computed } = Vue;

    const defaultData = {
        "uuid": "2025_hb_eng_part4_p1",
        "title": "Part Ⅳ 阅读理解",
        "score_desc": "根据文章内容完成问答，本篇共5小题，每题2分，共10分",
        "difficulty": "Medium",
        "content": "Passage {{br}} {{indent}}Anna and her girl friends decided to take a journey along the river’s path. They rented a small boat and packed food, drinks, and blankets for the day. The sun was shining brightly, making the river look like a sea of stars. The gentle breeze carried the scent of blooming flowers from the riverbanks nearby. {{br}} {{indent}}As they moved forward, birds flew overhead, singing songs in the air. They enjoyed watching the ducks swim and play in the clear, sparkling water. Anna loved the calming sound of the river as it flowed past them. Soon, they reached a quiet spot where they decided to stop for lunch. They spread out the blankets and sat down, enjoying sandwiches and fresh fruit. Laughter filled the air as they shared stories and recalled past adventures together. The river flowed gently by, listening quietly to their cheerful conversations. {{br}} {{indent}}Afterwards, they continued their journey, discovering new sights. They saw a family of ducks bathing in the warm afternoon sun. Anna felt grateful for this peaceful day spent with nature and good friends. {{br}} {{indent}}As evening approached, they knew it was time to head back home. They rowed slowly, watching the sunset paint the sky with shades of red and gold. The river shimmered one last time before the stars began to twinkle above. Anna and her friends promised to return to the river for another journey soon. Their hearts were full of joy and gratitude for this unforgettable day together. {{br}}{{br}} {{index}}. What did Anna and her girl friends pack for their boat journey? {{br}} {{long_line}} {{br}}{{br}} {{index}}. How did Anna feel about the calming sound of the river? {{br}} {{long_line}} {{br}}{{br}} {{index}}. Where did Anna and her friends stop for lunch? {{br}} {{long_line}} {{br}}{{br}} {{index}}. What promise did Anna and her friends make at the end of their journey? {{br}} {{long_line}} {{br}}{{br}} {{index}}. Translate the sentence \"Afterwards, they continued their journey, discovering new sights.\" into Chinese. {{br}} {{long_line}}",
        "answers": {
            "27": "They packed food, drinks, and blankets.",
            "28": "She loved the calming sound of the river.",
            "29": "They stopped at a quiet spot.",
            "30": "They promised to return to the river for another journey soon.",
            "31": "后来，她们继续旅程，发现了新的景色。"
        },
        "analyses": {
            "27": "细节题。根据第一段 'packed food, drinks, and blankets'。",
            "28": "细节题。根据第二段 'Anna loved the calming sound of the river'。",
            "29": "细节题。根据第二段 'reached a quiet spot where they decided to stop for lunch'。",
            "30": "细节题。根据最后一段 'Anna and her friends promised to return to the river for another journey soon'。",
            "31": "翻译题。注意 'Afterwards' (后来), 'continued' (继续), 'discovering' (发现) 的准确表达。"
        }
    };

    createApp({
        setup() {
            const jsonStr = ref(JSON.stringify(defaultData, null, 2));
            const errorMsg = ref(null);
            const showAnalysis = ref(false);

            const parsedData = computed(() => {
                try {
                    const data = JSON.parse(jsonStr.value);
                    errorMsg.value = null;
                    return data;
                } catch (e) {
                    errorMsg.value = e.message;
                    return null;
                }
            });

            const renderedHtml = computed(() => {
                if (!parsedData.value) return '';
                let text = parsedData.value.content;
                let idx = 0;

                // 1. 替换 Subtitle (居中标题)
                text = text.replace(/{{subtitle:(.*?)}}/g, '<div class="u-subtitle">$1</div>');

                // 2. 替换 Indent (首行缩进 - 新增)
                text = text.replace(/{{indent}}/g, '<span class="u-indent"></span>');

                // 3. 替换换行
                text = text.replace(/{{br}}/g, '<br/>');

                // 4. 替换序号 (适配 Part IV 序号 27-31)
                text = text.replace(/{{index}}/g, () => {
                    idx++;
                    return `<span class="u-index">${idx + 26}</span>`;
                });

                // 5. 替换填空线
                text = text.replace(/{{short_blank}}/g, '<span class="u-blank">_________</span>');
                text = text.replace(/{{long_line}}/g, '<span class="u-blank">___________________________________________________</span>');

                return text;
            });

            const sortedKeys = computed(() => {
                if (!parsedData.value) return [];
                return Object.keys(parsedData.value.answers).sort((a,b) => parseInt(a)-parseInt(b));
            });

            const resetJSON = () => jsonStr.value = JSON.stringify(defaultData, null, 2);

            return { jsonStr, errorMsg, parsedData, renderedHtml, showAnalysis, sortedKeys, resetJSON };
        }
    }).mount('#app');
</script>

</body>
</html>