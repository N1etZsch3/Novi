# 1.1 用户管理接口文档 

**Base URL**: `/api/v1/users` 

本模块处理用户注册、登录、个人信息管理及偏好设置。 

## 通用响应结构 

所有接口（除流式聊天外）返回统一 JSON 结构：

```json
{
  "code": 1,          // 1: 成功, 0: 失败
  "msg": "success",   // 提示信息
  "data": { ... }     // 业务数据
}xxxxxxxxxx {  "code": 0,  "msg": "Invalid preferences format",  "data": null}JSON
```

---

## 1. 用户注册

- **URL**: `/register`
- **Method**: `POST`
- **Auth**: 无需认证

**Request Body:**

| **字段**   | **类型** | **必填** | **描述** | **校验规则**                           |
| ---------- | -------- | -------- | -------- | -------------------------------------- |
| `username` | string   | 是       | 用户名   | 4-20位                                 |
| `password` | string   | 是       | 密码     | 8-30位，需含大小写字母、数字、特殊字符 |
| `email`    | string   | 是       | 邮箱     | 需符合邮箱格式                         |
| `nickname` | string   | 否       | 昵称     | 最大20位                               |

**Example:**

```json
{
    "username": "novi_user",
    "password": "Password123!",
    "email": "user@example.com",
    "nickname": "NoviFriend"
}
```

------



## 2. 用户登录

- **URL**: `/login`
- **Method**: `POST`
- **Auth**: 无需认证

**Request Body:**

| **字段**   | **类型** | **必填** | **描述** |
| ---------- | -------- | -------- | -------- |
| `username` | string   | 是       | 用户名   |
| `password` | string   | 是       | 密码     |

**Response (Success):**

```JSON
{
    "code": 1,
    "msg": "success",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiJ9...", // JWT Token
        "userId": 1
    }
}
```

> **注意**: 后续所有需要认证的接口，需在 Header 中携带: `Authorization: Bearer <token>`

------



## 3. 获取当前用户信息

- **URL**: `/me`
- **Method**: `GET`
- **Auth**: Required

**Response (Success):**

```JSON
{
    "code": 1,
    "msg": "success",
    "data": {
        "id": 1,
        "username": "novi_user",
        "nickname": "NoviFriend",
        "email": "user@example.com",
        "createdAt": "2025-11-19T10:00:00",
        "updatedAt": "2025-11-19T10:00:00"
    }
}
```

------



## 4. 更新当前用户信息

- **URL**: `/me`
- **Method**: `PUT`
- **Auth**: Required

**Request Body:**

| **字段**   | **类型** | **必填** | **描述**                   |
| ---------- | -------- | -------- | -------------------------- |
| `nickname` | string   | 是       | 新昵称                     |
| `email`    | string   | 是       | 新邮箱（若变更会检查冲突） |

**Example:**

```JSON
{
    "nickname": "BestFriend",
    "email": "new_email@example.com"
}
```

------



## 5. 获取/更新用户偏好

系统支持存储任意 JSON 格式的用户偏好（如 AI 性格设置），用于个性化 Prompt。

### 5.1 获取偏好

- **URL**: `/me/preferences`
- **Method**: `GET`
- **Response**: 返回一个 Map 对象。

### 5.2 更新偏好 (全量覆盖)

- **URL**: `/me/preferences`
- **Method**: `PUT`
- **Request Body**: 任意 JSON 对象。

**Example:**

```json
{
    "personality": "witty",  // 幽默风趣
    "voice": "female_A",     // 语音包设置
    "replyLength": "short"   // 回复简短
}
```

